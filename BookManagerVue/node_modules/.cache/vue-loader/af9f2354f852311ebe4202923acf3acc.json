{"remainingRequest":"D:\\BookManager\\BookManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\BookManager\\BookManagerVue\\src\\views\\borrow\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\BookManager\\BookManagerVue\\src\\views\\borrow\\index.vue","mtime":1719201442601},{"path":"D:\\BookManager\\BookManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1713778494000},{"path":"D:\\BookManager\\BookManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1713778492000},{"path":"D:\\BookManager\\BookManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1713778494000},{"path":"D:\\BookManager\\BookManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1713778512000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBtYXBHZXR0ZXJzIH0gZnJvbSAidnVleCI7DQppbXBvcnQgcGVybWlzc2lvbiBmcm9tICJAL2RpcmVjdGl2ZS9wZXJtaXNzaW9uL2luZGV4LmpzIjsgLy8g5p2D6ZmQ5Yik5pat5oyH5LukDQppbXBvcnQgd2F2ZXMgZnJvbSAiQC9kaXJlY3RpdmUvd2F2ZXMiOyAvLyB3YXZlcyBkaXJlY3RpdmUNCmltcG9ydCB7DQogIGdldENvdW50LA0KICBxdWVyeUJvcnJvd3MsDQogIHF1ZXJ5Qm9ycm93c0J5UGFnZSwNCiAgYWRkQm9ycm93LA0KICBkZWxldGVCb3Jyb3csDQogIGRlbGV0ZUJvcnJvd3MsDQogIHVwZGF0ZUJvcnJvdywNCiAgcmV0dXJuQm9vaywNCn0gZnJvbSAiQC9hcGkvYm9ycm93IjsNCmltcG9ydCB7DQogIC8vIGdldENvdW50LA0KICBxdWVyeUJvb2tJbmZvc0J5UGFnZSwNCiAgYWRkQm9va0luZm8sDQogIGRlbGV0ZUJvb2tJbmZvLA0KICBkZWxldGVCb29rSW5mb3MsDQogIHVwZGF0ZUJvb2tJbmZvLA0KfSBmcm9tICJAL2FwaS9ib29raW5mbyI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIkJvb2tpbmZvIiwNCiAgZGlyZWN0aXZlczogeyB3YXZlcywgcGVybWlzc2lvbiB9LA0KICAvLyDliJvlu7rlkI4NCiAgY3JlYXRlZCgpIHsNCiAgICAvLyDku47mnI3liqHlmajojrflj5bmlbDmja7ooajmoLznrKzkuIDpobXnmoTkv6Hmga8NCiAgICBxdWVyeUJvcnJvd3NCeVBhZ2UodGhpcy5xdWVyeVBhcmFtKS50aGVuKChyZXMpID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCLpppbpobXmlbDmja7ojrflj5bmiJDlip8iLCByZXMpOw0KICAgICAgdGhpcy50YWJsZURhdGEgPSByZXMuZGF0YTsNCiAgICAgIHRoaXMucmVjb3JkVG90YWwgPSByZXMuY291bnQ7DQogICAgICA7DQogICAgfSk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDliIbpobXlpKflsI/mlLnlj5jnm5HlkKwNCiAgICBoYW5kbGVTaXplQ2hhbmdlKGN1clNpemUpIHsNCiAgICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMucXVlcnlQYXJhbTsNCiAgICAgIHBhcmFtcy5saW1pdCA9IGN1clNpemU7DQogICAgICBxdWVyeUJvcnJvd3NCeVBhZ2UocGFyYW1zKS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgY29uc29sZS5sb2coIuWIhumhteaVsOaNruiOt+WPluaIkOWKnyIsIHJlcyk7DQogICAgICAgIHRoaXMudGFibGVEYXRhID0gcmVzLmRhdGE7DQogICAgICAgIHRoaXMucmVjb3JkVG90YWwgPSByZXMuY291bnQ7DQogICAgICAgIDsNCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICAvLyDngrnlh7vliIbpobXnm5HlkKzmlrnms5UNCiAgICBoYW5kbGVDdXJyZW50Q2hhbmdlKGN1clBhZ2UpIHsNCiAgICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMucXVlcnlQYXJhbTsNCiAgICAgIHBhcmFtcy5wYWdlID0gY3VyUGFnZTsNCiAgICAgIHF1ZXJ5Qm9ycm93c0J5UGFnZShwYXJhbXMpLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBjb25zb2xlLmxvZygi5YiG6aG15pWw5o2u6I635Y+W5oiQ5YqfIiwgcmVzKTsNCiAgICAgICAgdGhpcy50YWJsZURhdGEgPSByZXMuZGF0YTsNCiAgICAgICAgdGhpcy5yZWNvcmRUb3RhbCA9IHJlcy5jb3VudDsNCiAgICAgICAgOw0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIC8vIOaQnOe0og0KICAgIGhhbmRsZUZpbHRlcigpIHsNCiAgICAgIHRoaXMucXVlcnlQYXJhbS5wYWdlID0gMTsNCiAgICAgIHF1ZXJ5Qm9ycm93c0J5UGFnZSh0aGlzLnF1ZXJ5UGFyYW0pLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBpZiAocmVzLmNvZGUgPT09IDApIHsNCiAgICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IHJlcy5kYXRhOw0KICAgICAgICAgIHRoaXMucmVjb3JkVG90YWwgPSByZXMuY291bnQ7DQogICAgICAgIH0NCiAgICAgICAgOw0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIC8vIOaYvuekuuWFqOmDqA0KICAgIGhhbmRsZVNob3dBbGwoKSB7DQogICAgICB0aGlzLnF1ZXJ5UGFyYW0ucGFnZSA9IDE7DQogICAgICB0aGlzLnF1ZXJ5UGFyYW0udXNlcm5hbWUgPSBudWxsOw0KICAgICAgdGhpcy5xdWVyeVBhcmFtLmJvb2tuYW1lID0gbnVsbDsNCiAgICAgIHF1ZXJ5Qm9ycm93c0J5UGFnZSh0aGlzLnF1ZXJ5UGFyYW0pLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBpZiAocmVzLmNvZGUgPT09IDApIHsNCiAgICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IHJlcy5kYXRhOw0KICAgICAgICAgIHRoaXMucmVjb3JkVG90YWwgPSByZXMuY291bnQ7DQogICAgICAgIH0NCiAgICAgICAgOw0KICAgICAgfSk7DQogICAgfSwNCg0KDQogICAgZ290b1BheUluZm8oKXsNCiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvcGF5aW5mbycpOw0KDQogICAgfSwNCiAgICAvLyDov5jkuaYNCiAgICBoYW5kbGVSZXR1cm4ocm93LCBpbmRleCkgew0KICAgICAgdGhpcy4kY29uZmlybSgi56Gu5a6a6KaB6LSt5Lmw5ZCXPyIsICLmj5DnpLoiLCB7DQogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsDQogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgIH0pLnRoZW4oKCkgPT4gew0KICAgICAgICByZXR1cm5Cb29rKHJvdy5ib3Jyb3dpZCwgcm93LmJvb2tpZCkudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcyA9PT0gMSkgew0KICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLotK3kubDmiJDlip8iKTsNCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0idGhpcy4kcm91dGVyLnB1c2goJy9wYXknKSINCiAgICAgICAgICAgIHRoaXMuaGFuZGxlQ3VycmVudENoYW5nZSh0aGlzLnF1ZXJ5UGFyYW0ucGFnZSk7DQogICAgICAgICAgfSBlbHNlIGlmIChyZXMgPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivpeWbvuS5puW3sue7j+aYr+W9kui/mOeahOeKtuaAgSIpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLov5jkuablpLHotKUiKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfSk7DQogICAgfSwNCg0KDQogIH0sDQogIG1vdW50ZWQoKSB7DQoNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgLy8g6KGo5qC85pWw5o2uDQogICAgICB0YWJsZURhdGE6IFtdLA0KICAgICAgLy8g6K6w5b2V5oC75pWwDQogICAgICByZWNvcmRUb3RhbDogMCwNCiAgICAgIC8vIOafpeivouWPguaVsA0KICAgICAgcXVlcnlQYXJhbTogew0KICAgICAgICBwYWdlOiAxLA0KICAgICAgICBsaW1pdDogMTAsDQogICAgICAgIHVzZXJpZDogbnVsbCwNCiAgICAgICAgdXNlcm5hbWU6IG51bGwsDQogICAgICAgIGJvb2tuYW1lOiBudWxsLA0KICAgICAgICAvLyBjYXBhY2l0eTogbnVsbCwNCiAgICAgIH0sDQogICAgfTsNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICAvLyDojrflvpd1c2Vy5L+h5oGvDQogICAgLi4ubWFwR2V0dGVycyhbImlkIiwgIm5hbWUiLCAicm9sZXMiXSksDQogICAgcm9sZUlzQWRtaW4oKSB7DQogICAgICBpZiAodGhpcy5yb2xlc1swXSA9PT0gImFkbWluIikgcmV0dXJuIHRydWU7DQogICAgICBlbHNlIHJldHVybiBmYWxzZTsNCiAgICB9LA0KICB9LA0KICB3YXRjaDogew0KICAgICJxdWVyeVBhcmFtLnVzZXJpZCI6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIoKSB7DQogICAgICAgIGlmICh0aGlzLnJvbGVJc0FkbWluKSB7DQogICAgICAgICAgdGhpcy5xdWVyeVBhcmFtLnVzZXJpZCA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5xdWVyeVBhcmFtLnVzZXJpZCA9IHRoaXMuaWQ7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgfSwNCiAgfSwNCn07DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/borrow","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <!-- 顶部功能 -->\r\n    <div class=\"filter-container\" style=\"margin-bottom: 15px\">\r\n\r\n      <!-- 图书名输入 -->\r\n      <el-input\r\n        v-model=\"queryParam.bookname\"\r\n        placeholder=\"图书名\"\r\n        style=\"width: 200px\"\r\n        class=\"filter-item\"\r\n        @keyup.enter.native=\"handleFilter\"\r\n      />\r\n      <br /><br />\r\n      <!-- 一些按钮 -->\r\n      <el-button\r\n        v-waves\r\n        class=\"filter-item\"\r\n        type=\"primary\"\r\n        style=\"font-size: 18px\"\r\n        @click=\"handleFilter\"\r\n      >\r\n\r\n        搜索\r\n      </el-button>\r\n      <el-button\r\n        v-waves\r\n        class=\"filter-item\"\r\n        type=\"primary\"\r\n        style=\"font-size: 18px\"\r\n        @click=\"handleShowAll\"\r\n      >\r\n\r\n        显示全部\r\n      </el-button>\r\n\r\n    </div>\r\n\r\n    <!--数据表格-->\r\n    <el-table\r\n      ref=\"multipleTable\"\r\n      :data=\"tableData\"\r\n      border\r\n      style=\"width: 100%\"\r\n    >\r\n      <el-table-column fixed type=\"selection\" width=\"55\">\r\n      </el-table-column>\r\n\r\n      <el-table-column fixed prop=\"buyId\" label=\"购买单号\" width=\"100\">\r\n      </el-table-column>\r\n      <el-table-column\r\n        prop=\"bookName\"\r\n        label=\"图书名\"\r\n        show-overflow-tooltip\r\n      >\r\n      </el-table-column>\r\n      <el-table-column prop=\"buyNum\" label=\"购买数量\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"bookPrice\" label=\"购买价格\">\r\n      </el-table-column>\r\n\r\n      <el-table-column prop=\"buyTime\" label=\"购买时间\" sortable>\r\n      </el-table-column>\r\n\r\n\r\n      <el-table-column\r\n        v-if=\"!roleIsAdmin\"\r\n        fixed=\"right\"\r\n        label=\"操作\"\r\n        :width=\" '180px'\"\r\n      >\r\n        <template slot-scope=\"scope\">\r\n\r\n          <el-button\r\n            v-if=\"!roleIsAdmin\"\r\n            @click=\"gotoPayInfo\"\r\n            type=\"success\"\r\n            style=\"font-size: 22px\"\r\n          >再次购买</el-button>\r\n        </template>\r\n      </el-table-column>\r\n\r\n\r\n\r\n\r\n    </el-table>\r\n\r\n    <!--分页条-->\r\n    <el-pagination\r\n      background\r\n      @size-change=\"handleSizeChange\"\r\n      @current-change=\"handleCurrentChange\"\r\n      :current-page.sync=\"queryParam.page\"\r\n      :page-sizes=\"[5, 10, 20, 50]\"\r\n      :page-size=\"queryParam.limit\"\r\n      layout=\"total, sizes, prev, pager, next, jumper\"\r\n      :total=\"recordTotal\"\r\n      style=\"margin-top: 15px\"\r\n    >\r\n    </el-pagination>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from \"vuex\";\r\nimport permission from \"@/directive/permission/index.js\"; // 权限判断指令\r\nimport waves from \"@/directive/waves\"; // waves directive\r\nimport {\r\n  getCount,\r\n  queryBorrows,\r\n  queryBorrowsByPage,\r\n  addBorrow,\r\n  deleteBorrow,\r\n  deleteBorrows,\r\n  updateBorrow,\r\n  returnBook,\r\n} from \"@/api/borrow\";\r\nimport {\r\n  // getCount,\r\n  queryBookInfosByPage,\r\n  addBookInfo,\r\n  deleteBookInfo,\r\n  deleteBookInfos,\r\n  updateBookInfo,\r\n} from \"@/api/bookinfo\";\r\n\r\nexport default {\r\n  name: \"Bookinfo\",\r\n  directives: { waves, permission },\r\n  // 创建后\r\n  created() {\r\n    // 从服务器获取数据表格第一页的信息\r\n    queryBorrowsByPage(this.queryParam).then((res) => {\r\n      console.log(\"首页数据获取成功\", res);\r\n      this.tableData = res.data;\r\n      this.recordTotal = res.count;\r\n      ;\r\n    });\r\n  },\r\n  methods: {\r\n    // 分页大小改变监听\r\n    handleSizeChange(curSize) {\r\n      const params = this.queryParam;\r\n      params.limit = curSize;\r\n      queryBorrowsByPage(params).then((res) => {\r\n        console.log(\"分页数据获取成功\", res);\r\n        this.tableData = res.data;\r\n        this.recordTotal = res.count;\r\n        ;\r\n      });\r\n    },\r\n\r\n    // 点击分页监听方法\r\n    handleCurrentChange(curPage) {\r\n      const params = this.queryParam;\r\n      params.page = curPage;\r\n      queryBorrowsByPage(params).then((res) => {\r\n        console.log(\"分页数据获取成功\", res);\r\n        this.tableData = res.data;\r\n        this.recordTotal = res.count;\r\n        ;\r\n      });\r\n    },\r\n\r\n    // 搜索\r\n    handleFilter() {\r\n      this.queryParam.page = 1;\r\n      queryBorrowsByPage(this.queryParam).then((res) => {\r\n        if (res.code === 0) {\r\n          this.tableData = res.data;\r\n          this.recordTotal = res.count;\r\n        }\r\n        ;\r\n      });\r\n    },\r\n\r\n    // 显示全部\r\n    handleShowAll() {\r\n      this.queryParam.page = 1;\r\n      this.queryParam.username = null;\r\n      this.queryParam.bookname = null;\r\n      queryBorrowsByPage(this.queryParam).then((res) => {\r\n        if (res.code === 0) {\r\n          this.tableData = res.data;\r\n          this.recordTotal = res.count;\r\n        }\r\n        ;\r\n      });\r\n    },\r\n\r\n\r\n    gotoPayInfo(){\r\n      this.$router.push('/payinfo');\r\n\r\n    },\r\n    // 还书\r\n    handleReturn(row, index) {\r\n      this.$confirm(\"确定要购买吗?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      }).then(() => {\r\n        returnBook(row.borrowid, row.bookid).then((res) => {\r\n          if (res === 1) {\r\n            this.$message.success(\"购买成功\");\r\n            window.location.href =\"this.$router.push('/pay')\"\r\n            this.handleCurrentChange(this.queryParam.page);\r\n          } else if (res === 0) {\r\n            this.$message.error(\"该图书已经是归还的状态\");\r\n          } else {\r\n            this.$message.error(\"还书失败\");\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n\r\n  },\r\n  mounted() {\r\n\r\n  },\r\n  data() {\r\n    return {\r\n      // 表格数据\r\n      tableData: [],\r\n      // 记录总数\r\n      recordTotal: 0,\r\n      // 查询参数\r\n      queryParam: {\r\n        page: 1,\r\n        limit: 10,\r\n        userid: null,\r\n        username: null,\r\n        bookname: null,\r\n        // capacity: null,\r\n      },\r\n    };\r\n  },\r\n  computed: {\r\n    // 获得user信息\r\n    ...mapGetters([\"id\", \"name\", \"roles\"]),\r\n    roleIsAdmin() {\r\n      if (this.roles[0] === \"admin\") return true;\r\n      else return false;\r\n    },\r\n  },\r\n  watch: {\r\n    \"queryParam.userid\": {\r\n      immediate: true,\r\n      handler() {\r\n        if (this.roleIsAdmin) {\r\n          this.queryParam.userid = null;\r\n        } else {\r\n          this.queryParam.userid = this.id;\r\n        }\r\n      },\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  line-height: 178px;\r\n  text-align: center;\r\n}\r\n.avatar {\r\n  width: 150px;\r\n  height: 200px;\r\n  display: block;\r\n}\r\n</style>\r\n"]}]}